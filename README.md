# API Gateway Federator (AGF) Specification

This repository contains classes and interfaces which can be used for implementing an API Gateway Federator, a software for abstracting the use of API Gateway managers and avoiding vendor lock-in.

This project uses [Maven](https://maven.apache.org/guides/index.html) as dependency manager.

## UML Documentation

[Class diagrams](docs/README.md)

Class diagrams were generated by [PlantUML](https://plantuml.com). This tool requires, besides Java, [Graphviz](https://gitlab.com/graphviz/graphviz), which can be installed in Debian with `sudo apt install graphviz`.

The process of generating the diagrams is like this:

1. Download PlantUML from https://plantuml.com/download to the project root. The `.gitignore` file is set to ignore `.jar` files in the project root.

2. Rename the downloaded file to `plantuml.jar`.

3. Install [GenUML](https://github.com/samuller/genuml):

```shell
pip install genuml
```

4. Run [generatedocs.php](generatedocs.php) script:

```shell
php generatedocs.php
```

This script makes the following steps:

1. It create a .puml file for each Java class or interface found in the  `org.vendorunlockingpatterns`.

2. It gathers the classes of a same package into a same .puml file and deletes the individual files.

3. It generates images of the class diagrams from the .puml files.

4. It recreates docs/README.md file with the links to the generated images.

## Javadoc

[Javadoc site](./impl/target/site/apidocs/index.html)

For generating Javadoc HTML documentation, run the following command at `impl` directory:

```shell
mvn javadoc:javadoc
```

## Deployment

You must change `version` tag in [POM file](impl/pom.xml) before to deploy.

```shell
mvn clean install javadoc:jar source:jar deploy
```

The `settings.xml` file of Maven, located in `~/.m2` directory, must have the following section:

```xml
  <servers>
    <server>
      <id>github</id>
      <username>[USERNAME]</username>
      <password>[PERSONAL ACCESS TOKEN]</password>
    </server>
    <server>
      <id>gpg.passphrase</id>
      <passphrase>[GPG PASSPHRASE]</passphrase>
    </server>
  </servers>
```

The **personal access token** must be created in your Github account at this path: `Settings` | `Developer Settings` | `Personal access token` | `Tokens (classic)`. The access token needs to be defined with the scopes `repo`, `write:packages` and `delete:packages`.

The GPG key must be added to your Github profile at this path: `Settings` | `SSH and GPG keys` | `New GPG key`

Reference for publishing of packages in Github:

* https://docs.github.com/en/actions/use-cases-and-examples/publishing-packages/publishing-java-packages-with-maven

TODO: publish packages to Sonatype

Obstacle: domain ownership.

Reference for Sonatype deployment:

* https://central.sonatype.org/publish/requirements
* https://central.sonatype.org/publish/publish-maven/
